controller_manager:
  ros__parameters:
    update_rate: 100  # Reduced from 200 - still fast but more reasonable
    
    gains:
      # More conservative PID gains to reduce overshoot
      wheel1_joint: {p: 10.0, i: 0.1, d: 0.1, i_clamp: 1.0, ff: 1.0}
      wheel2_joint: {p: 10.0, i: 0.1, d: 0.1, i_clamp: 1.0, ff: 1.0}
      wheel3_joint: {p: 10.0, i: 0.1, d: 0.1, i_clamp: 1.0, ff: 1.0}
    
    joint_state_broadcaster:
      type: joint_state_broadcaster/JointStateBroadcaster
    
    omni_drive_controller:
      type: omni_wheel_drive_controller/OmniWheelDriveController

omni_drive_controller:
  ros__parameters:
    wheel_offset: 0.523599 #pi/6
    wheel_names:
      [
        "wheel1_joint",
        "wheel2_joint",
        "wheel3_joint",
      ]
    robot_radius: 0.125 # for cylindrical wheels: 0.128 = 0.115 + 0.0125 (radius + half wheel width), for omni wheels: 0.1297
    wheel_radius: 0.024

    odom_frame_id: odom
    base_frame_id: base_link
    enable_odom_tf: false #let ekf handle odometry should be official param but not being respected idk why
    publish_tf: false #maybe this helps
    publish_odom_tf: false

        # --- odom covariances (make EKF treat planar info as reasonable, others as low-trust) ---
    # Pose: [x, y, z, roll, pitch, yaw]
    diagonal_covariance.pose:  [0.02, 0.02, 1e3, 1e3, 1e3, 0.05]
    # Twist: [vx, vy, vz, wx, wy, wz]
    diagonal_covariance.twist: [0.05, 0.05, 1e3, 1e3, 1e3, 0.05]

    # --- odom source ---
    open_loop: false              # use measured joint states, not commanded
    position_feedback: true       # Gazebo provides joint position feedback

    # --- safety/UX ---
    cmd_vel_timeout: 0.5
    publish_limited_velocity: true